<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Southern Tide Solutions - Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 12px;
        margin: 10px 0;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      select,
      button {
        padding: 10px;
        font-size: 16px;
      }
      .muted {
        color: #666;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <h1>Booking Demo</h1>

    <div class="row">
      <label>
        Business:
        <select id="business">
          <option value="">All</option>
          <option value="seadog">seadog</option>
          <option value="islandtime">islandtime</option>
        </select>
      </label>

      <button id="load">Load Bookings</button>
    </div>

    <p class="muted" id="status"></p>
    <div id="list"></div>

    <script>
      const statusEl = document.getElementById("status");
      const listEl = document.getElementById("list");
      const businessEl = document.getElementById("business");
      const loadBtn = document.getElementById("load");

      async function loadBookings() {
        listEl.innerHTML = "";
        statusEl.textContent = "Loading...";

        const businessId = businessEl.value;
        const url = businessId
          ? `/api/bookings?businessId=${encodeURIComponent(businessId)}`
          : `/api/bookings`;

        try {
          const res = await fetch(url);
          const data = await res.json();

          const bookings = data.bookings || [];
          statusEl.textContent = `Found ${bookings.length} booking(s).`;

          bookings.forEach((b) => {
            const remaining = (b.capacity ?? 0) - (b.booked ?? 0);

            const div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `
              <b>${b.trip}</b>
              <div class="muted">Business: ${b.businessId}</div>
              <div class="muted">Date: ${b.date}</div>
              <div>Booked: ${b.booked} / ${b.capacity} (Remaining: ${remaining})</div>
            `;
            listEl.appendChild(div);
          });

          if (bookings.length === 0) {
            listEl.innerHTML = `<div class="muted">No results.</div>`;
          }
        } catch (err) {
          statusEl.textContent = "Error loading bookings.";
          listEl.innerHTML = `<pre>${err}</pre>`;
        }
      }

      loadBtn.addEventListener("click", loadBookings);
      loadBookings();
    </script>
  </body>
</html>
